<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Animated Tomato Tosser</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f0f0; }
        .wrapper { position: relative; display: inline-block; line-height: 0; }
        canvas { border: 4px solid #333; max-width: 100%; height: auto; background: #fff; }
        
        .tomato-splat {
            position: absolute;
            pointer-events: none;
            transform: translate(-50%, -50%);
            width: 300px; 
            height: 300px;
        }

        .controls { margin: 20px; gap: 10px; display: flex; }
        button, label { padding: 10px 20px; cursor: pointer; background: #a42525; border: none; color: white; border-radius: 5px; font-weight: bold; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

    <h2>Click to Throw!</h2>

    <div class="wrapper" id="container">
        <canvas id="canvas"></canvas>
        </div>

    <div class="controls">
        <label for="uploadInput">üìÅ Upload Image</label>
        <input type="file" id="uploadInput" accept="image/*">
        <button id="resetBtn">Clear All</button>
        <button id="exportBtn">Export GIF</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('container');
        const uploadInput = document.getElementById('uploadInput');
        
        const targetImg = new Image();
        targetImg.src = 'placeholder.png'; // Your default background

        targetImg.onload = () => {
            canvas.width = targetImg.width;
            canvas.height = targetImg.height;
            ctx.drawImage(targetImg, 0, 0);
        };

        // Handle Clicking
        container.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            
            // Get click coordinates relative to the display size
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Create a new IMG element for the animated GIF
            const splat = document.createElement('img');
            
            // Adding a timestamp to the URL forces the GIF to restart from Frame 1
            splat.src = `./images/tomato.gif?t=${Date.now()}`;
            splat.className = 'tomato-splat';
            splat.style.left = `${x}px`;
            splat.style.top = `${y}px`;

            container.appendChild(splat);
        });

        // Upload Logic
        uploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                targetImg.src = event.target.result;
                document.querySelectorAll('.tomato-splat').forEach(s => s.remove());
            };
            reader.readAsDataURL(file);
        });

        document.getElementById('resetBtn').onclick = () => {
            document.querySelectorAll('.tomato-splat').forEach(s => s.remove());
        };

        // GIF Export Note:
        // Exporting an "animated GIF composed of other animated GIFs" in JS is complex.
        // This button currently captures the final "static" state.
        document.getElementById('exportBtn').onclick = () => {
            alert("To export the full animation, we would need to frame-capture the DOM. For now, this saves the current layout!");
        };
    </script>
</body>
</html>